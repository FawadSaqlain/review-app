<% var email = typeof email !== 'undefined' ? email : '' %>
<h2>Verify your account</h2>
<p>We've sent an OTP to <strong><%= email %></strong>. Enter it below to verify your account.</p>
<form id="verifyForm">
  <input type="hidden" id="email" name="email" value="<%= email %>">
  <div class="form-row">
    <label for="otp">OTP</label>
    <input id="otp" name="otp" type="text" placeholder="Enter OTP" />
  </div>
  <div class="form-row">
    <button type="submit">Verify</button>
    <button type="button" id="resend" class="secondary">Resend OTP</button>
  </div>
  <div id="msg" class="response"></div>
</form>

<script>
document.getElementById('verifyForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const email = document.getElementById('email').value;
  const otp = document.getElementById('otp').value;
  const res = await fetch('/api/auth/verify-signup', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ email, otp }), credentials: 'same-origin' });
  const json = await res.json();
  document.getElementById('msg').textContent = json.success ? json.data.message || 'Verified' : (json.error && json.error.message) || 'Error';
  if (json.success) setTimeout(()=> location.href = '/login', 1200);
});

document.getElementById('resend').addEventListener('click', async function(){
  const email = document.getElementById('email').value;
  const res = await fetch('/api/auth/resend-signup-otp', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ email }), credentials: 'same-origin' });
  const json = await res.json();
  document.getElementById('msg').textContent = json.success ? (json.data && (json.data.message || 'OTP resent')) : (json.error && json.error.message) || 'Error';
});
</script>
